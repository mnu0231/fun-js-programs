<!doctype HTML>
<html>
  <head>
    <title>YT Playlist Maker</title>
    <style>
      * {
        padding: 0px;
        border: none;
        margin: 0px;
        font-family: sans-serif;
        box-sizing: border-box;
      }
      body {
        background-color: black;
      }
      header {
        margin-top: 0px;
        width: 100%;
        padding: 10px;
        border: 1px solid black;
        text-align: center;
        background: black;
      }
      nav {
        border-top: 1px solid darkgray;
        border-left: 1px solid darkgray;
        border-bottom: 1px solid darkgray;
        width: 100%;
      }
      h1 {
        display: inline-block;
        color: white;
        padding: 3px 10px;
        border: 1px solid black;
        background: black;
        text-shadow: 2px 2px rgba(3,248,252,0.53), -2px -2px rgba(252,3,215,0.53);
      }
      h2 {
        margin-bottom: 5px;
        color: white;
        display: inline-block;
      }
      section {
        background: black;
      }
      input {
        width: 20%;
        margin-right: 5px;
        border: 1px solid black;
      }
      button {
        border: 1px solid black;
        padding: 2px 3px;
        background: white;
      }
      button:hover {
        cursor: pointer;
        border: 1px solid gold;
      }
      .pushBox {
        width: 107px;
        min-width: 107px;
        height: 60px;
        border: 1px solid darkgray;
        font-size: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-size: cover;
        background-position: center;
        position: relative;
      }
      .pushBox:hover {
        cursor: pointer;
        box-shadow: inset 0px 0px 3px 2px lightgray;
      }
      .playlistPosition {
        padding: 1px 2px;
        background: white;
        position: absolute;
        left: 0px;
        top: 0px;
      }
      .deletePushBox {
        color: white;
        background: rgba(0,0,0,0.83);
        padding: 1px 2px;
        position: absolute;
        top: 0px;
        right: 0px;
      }
      .deletePushBox:hover {
        background: rgba(255,0,0,0.83);
      }
      #shell {
        width: 100%;
        border: 1px solid black;
        display: flex;
        flex-direction: column;
      }
      #frame {
        width: 100%;
        height: 316px;
        border: 1px solid darkgray;
      }
      #submissions {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: flex-start;
        border: 1px solid white;
        background-color: white;
        padding: 3px;
      }
      #submissions button {
        margin-right: 5px;
      }
      #loadSaveDIV, #submitResetDIV, #prevNextDIV, #currentlyViewingDIV {
        display: flex;
        align-items: center;
        justify-content: space-around;
      }
      #controls {
        overflow: scroll;
        width: 100%;
        display: flex;
        border-left: 1px solid darkgray;
        border-right: 1px solid darkgray;
      }
      #extras {
        padding: 7px 10px;
      }
      #instructions {
        width: 100%;
        border: 1px solid black;
        padding: 10px;
        background: black;
      }
      #instButton {
        margin: 0px 0px 0px 10px;
      }
      @media screen and (min-width: 700px) {
        header {
          width: 700px;
          margin: 25px auto 0px auto;
        }
        main {
          width: 700px;
          margin: 0px auto;
        }
        nav {
          border-top: 1px solid darkgray;
          border-left: none;
          border-bottom: 1px solid darkgray;
          height: 316px;
          width: 125px;
        }
        footer {
          width: 700px;
          margin: 0px auto 25px auto;
        }
        input {
          width: 100%;
          margin-left: 4px;
          border: 1px solid black;
        }
        .pushBox {
          height: 60px;
          min-height: 60px;
          width: 105px;
          min-width: 105px;
          border: 1px solid black;
          font-size: 8px;
          background-size: cover;
          background-position: center;
          position: relative;
        }
        .deletePushBox {
          color: white;
          background: rgba(0,0,0,0.83);
          padding: 1px 2px;
          position: absolute;
          top: 46px;
          right: 94px;
          display: block;
        }
        #shell {
          width: 100%;
          height: 316px;
          border: 1px solid black;
          display: flex;
          flex-direction: row;
        }
        #frame {
          width: 100%;
          height: 316px;
          border-top: 1px solid darkgray;
          border-bottom: 1px solid darkgray;
          border-left: none;
        }
        #submissions {
          height: 124px;
          display: flex;
          flex-direction: column;
          align-items: space-around;
          justify-content: space-around;
          border: 1px solid white;
          background-color: white;
        }
        #submissions button {
          margin-right: 0px;
        }
        #loadSaveDIV, #submitResetDIV, #prevNextDIV, #currentlyViewingDIV {
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: space-around;
        }
        #controls {
          height: 190px;
          overflow: scroll;
          display: flex;
          flex-direction: column;
          width: 100%:
          border-left: none;
          border-right: none;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>YouTube Playlist Maker</h1>
    </header>
    <main>
      <section>
        <div id="shell">
          <div id="frame">
            <iframe width="100%" height="314" src="https://www.youtube.com/embed/" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
          <nav>
            <div id="submissions">
              <input placeholder="URLs here">
              <div id="submitResetDIV">
                <button id="submit">Submit</button>
                <button id="reset">Reset</button>
              </div>
              <div id="loadSaveDIV">
                <button id="save">Save</button>
                <button id="load">Load</button>
              </div>
              <div id="prevNextDIV">
                <button id="previous">Prev</button>
                <button id="next">Next</button>
              </div>
              <div id="currentlyViewingDIV">
                <button id="shuffle">Shfl</button>
                <p id="currentlyViewing">0/0</p>
              </div>
            </div>
            <div id="controls"></div>
          </nav>
        </div>
      </section>
      <section id="extras">
        <div id="instructions">
          <h2>Instructions</h2>
          <button id="instButton">Display</button>
          <p>Add a comma separated list of YouTube video URLs into the text box, and press the <b>Submit</b> button to have your playlist produced. You can also preserve your playlist by pressing the <b>Save</b> button, which uploads a JSON file to your browser's local storage. That same JSON file can then be later accessed by pressing the <b>Load</b> button.</p>
        </div>
      </section>
    </main>
    <footer>
    </footer>
    <script>
      function main() {
        let bod = document.querySelector("body");
        let frame = document.querySelector("#frame");
        let videoBox = document.querySelector("#frame iframe");
        let inputField = document.querySelector("#submissions input")
        let submitButton = document.querySelector("#submit")
        let reset = document.querySelector("#reset");
        let save = document.querySelector("#save");
        let load = document.querySelector("#load");
        let prev = document.querySelector("#previous");
        let next = document.querySelector("#next");
        let shuffle = document.querySelector("#shuffle");
        let currentlyViewing = document.querySelector("#currentlyViewing");
        let controls = document.querySelector("#controls");
        let inst = document.querySelector("#instructions");
        let instTtitle = document.querySelector("h2");
        let instButton = document.querySelector("#instButton");
        let instP = document.querySelector("#instructions p");
        let tracker = [];
        let id = 0;
        let displayValue = 0;
        function initialConditions(){
          instP.style.display = "none";
        }
        initialConditions();
        function resetting(){
          controls.innerHTML = "";
          videoBox.src = `https://www.youtube.com/embed/`;
          inputField.value = "";
          tracker = [];
          id = 0;
        }
        function updatecurrentlyViewing(){
          let outOf = tracker.length;
          let atCurrently;
          for (let t of tracker) {
            if (t.active) {
              atCurrently = t.pushBox;
            }
          }
          if (outOf >= 1) {
            return `${Number(atCurrently) + 1}/${outOf}`;
          } else {
            return `0/${outOf}`;
          }
        }
        function idChecker(e){
          let library = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","_","0","1","2","3","4","5","6","7","8","9"];
          let ans = e.every(function(z){
            let inner = false;
            for (let y of library) {
              if (z == y) {
                inner = true;
              }
            }
            return inner;
          });
          return ans;
        }
        function squeeze(e){
          if ((e.includes("https://www.youtube.com/") || e.includes("https://m.youtube.com/") || e.includes("https://youtu.be/")) && (e.trim().indexOf("https://www.youtube.com/") == 0 || e.trim().indexOf("https://m.youtube.com/") == 0 || e.trim().indexOf("https://youtu.be/") == 0)) {
            if (e.includes("v=")) {
              let data = e.split("");
              let a = data.indexOf("v");
              if (a + 1 == data.indexOf("=",a)) {
                let revisedData;
                if (data.includes("&")) {
                  let b = data.indexOf("&",a);
                  revisedData = data.slice(a + 2,b);
                } else {
                  revisedData = data.slice(a + 2);
                }
                if (idChecker(revisedData)) {
                  return revisedData.join("");
                } else {
                  return false;
                }
              } else {
                return false;
              }
            } else if (e.includes(".be/")) {
              let data = e.split("");
              if (e.indexOf(".be") + 2 == e.indexOf("e/")) {
                let a = data.indexOf("/");
                let revisedData;
                if (data.includes("?")) {
                  let b = data.indexOf("?",a);
                  revisedData = data.slice(a + 11,b);
                } else {
                  revisedData = data.slice(a + 11);
                }
                if (idChecker(revisedData)) {
                  return revisedData.join("");
                } else {
                  return false;
                }
              } else {
                return false;
              }
            } else {
              return false;
            }
          } else {
            return false;
          }
        }
        function generate(e){
          for (let i = 0; i < e.length; i++) {
            if (e[i] !== "" && !e[i].includes("playlist") && !e[i].includes("search_query") && !e[i].includes("results") && Boolean(squeeze(e[i])) == true) {
              let pushBox = document.createElement("div");
              if (controls.children.length == 0) {
                videoBox.src = `https://www.youtube.com/embed/${squeeze(e[i])}`;
                pushBox.style.border = "1px solid gold";
              }
              pushBox.classList.add("pushBox");
              let rN1 = Math.floor(Math.random() * 256);
              let rN2 = Math.floor(Math.random() * 256);
              let rN3 = Math.floor(Math.random() * 256);
              pushBox.style.backgroundColor = "rgb(" + rN1 + "," + rN2 + "," + rN3 + ")";
              pushBox.style.backgroundImage = "url('http://img.youtube.com/vi/" + squeeze(e[i]) + "/0.jpg')";
              let tempP = document.createElement("p");
              tempP.style.display = "none";
              let tempTextNode = document.createTextNode(squeeze(e[i]));
              tempP.appendChild(tempTextNode);
              pushBox.appendChild(tempP);
              controls.appendChild(pushBox);
              if (tracker.length == 0) {
                tracker.push({active:true,pushBox:id.toString(),yT:squeeze(e[i])});
              } else {
                tracker.push({active:false,pushBox:id.toString(),yT:squeeze(e[i])});
              }
              pushBox.id = (id++).toString();
              let playlistPosition = document.createElement("p");
              playlistPosition.classList.add("playlistPosition");
              let playlistNumber = document.createTextNode(Number(pushBox.id) + 1);
              playlistPosition.appendChild(playlistNumber);
              pushBox.appendChild(playlistPosition);
              let deletePushBox = document.createElement("p");
              deletePushBox.classList.add("deletePushBox");
              let deletePushBoxText = document.createTextNode("X");
              deletePushBox.appendChild(deletePushBoxText);
              pushBox.appendChild(deletePushBox);
              pushBox.addEventListener("click",function(){
                videoBox.src = `https://www.youtube.com/embed/${tempP.innerHTML}`;
                let ch = controls.children;
                for (let c of ch) {
                  c.style.border = "1px solid black";
                }
                for (let t of tracker) {
                  if (t.pushBox == pushBox.id) {
                    pushBox.style.border = "1px solid gold";
                    t.active = true;
                  } else {
                    t.active = false;
                  }
                }
                currentlyViewing.innerText = updatecurrentlyViewing();
              });
              deletePushBox.addEventListener("click",function(event){
                let finalTracker = [];
                for (let t in tracker) {
                  if (tracker[t].pushBox != pushBox.id) {
                    let temp = "https://www.youtube.com/watch?v=" + tracker[t].yT;
                    finalTracker.push(temp);
                  }
                }
                resetting();
                generate(finalTracker);
                currentlyViewing.innerText = updatecurrentlyViewing();
                event.stopPropagation()
              });
              currentlyViewing.innerText = updatecurrentlyViewing();
            }
          }
        }
        submitButton.addEventListener("click",function(){
          let userInput = inputField.value.split(",");
          generate(userInput);
        });
        reset.addEventListener("click",function(){
          resetting();
          currentlyViewing.innerText = "0/0";
        });
        save.addEventListener("click",function(){
          let zeURLs = [];
          let conCh = controls.children;
          if (conCh.length > 0) {
            for (let c of conCh) {
              zeURLs.push("https://www.youtube.com/watch?v=" + c.firstElementChild.textContent);
            }
            localStorage.setItem("ids",JSON.stringify(zeURLs));
          }
        });
        load.addEventListener("click",function(){
          resetting();
          let data = localStorage.getItem("ids");
          let dataOpened = JSON.parse(data);
          generate(dataOpened);
        });
        prev.addEventListener("click",function(){
          let active;
          for (let i = 0; i < tracker.length; i++) {
            if (tracker[i].active) {
              active = Number(tracker[i].pushBox);
            }
          }
          if (active > 0) {
            videoBox.src = `https://www.youtube.com/embed/${tracker[active - 1].yT}`;
            let children = controls.children;
            children[active].style.border = "1px solid black";
            tracker[active].active = false;
            children[active - 1].style.border = "1px solid gold";
            tracker[active - 1].active = true;
            currentlyViewing.innerText = updatecurrentlyViewing();
          }
        });
        next.addEventListener("click",function(){
          let active;
          for (let i = 0; i < tracker.length; i++) {
            if (tracker[i].active) {
              active = Number(tracker[i].pushBox);
            }
          }
          if (active < tracker.length) {
            videoBox.src = `https://www.youtube.com/embed/${tracker[active + 1].yT}`;
            let children = controls.children;
            children[active].style.border = "1px solid black";
            tracker[active].active = false;
            children[active + 1].style.border = "1px solid gold";
            tracker[active + 1].active = true;
            currentlyViewing.innerText = updatecurrentlyViewing();
          }
        });
        shuffle.addEventListener("click",function(){
          if (tracker.length > 0) {
            let sortedTracker = tracker.sort(function(a,b){
              let rN = Math.random();
              if (rN < .5) {
                return 1;
              } else if (rN > .5) {
                return -1;
              } else {
                return 0
              }
            });
            resetting();
            let finalTracker = [];
            for (let t of sortedTracker) {
              let temp = "https://www.youtube.com/watch?v=" + t.yT;
              finalTracker.push(temp);
            }
            generate(finalTracker);
          }
        });
        instButton.addEventListener("click",function(){
          if (displayValue == 0) {
            inst.style.backgroundColor = "white";
            inst.style.padding = "10px";
            instTtitle.style.color = "black";
            instP.style.display = "block";
            this.textContent = "Hide";
            displayValue++;
          } else {
            inst.style.backgroundColor = "black";
            inst.style.padding = "10px";
            instTtitle.style.color = "white";
            instP.style.display = "none";
            this.textContent = "Display";
            displayValue = 0;
          }
        });
      }
      main();
    </script>
  </body>
</html>
